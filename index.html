<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>METAR Uruguay</title>
  <style>
    body {
      background-color: #121212;
      color: #f5f5f5;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #00bfff;
    }
    .metar-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .metar-card {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .metar-card.highlight {
      border: 2px solid #00bfff;
    }
    .metar-raw {
      font-size: 1rem;
      color: #bbb;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>METAR Uruguay</h1>

  <!-- Contenedor donde se insertarán las tarjetas -->
  <div id="metar" class="metar-container"></div>

  <script>
    // Lista de estaciones con sus nombres
    const stations = {
      "SUMU": "Carrasco",
      "SUAA": "Melilla",
      "SULS": "Laguna del Sauce",
      "SUSO": "Salto",
      "SUTB": "Tacuarembó",
      "SULM": "La Mina",
      "SUKO": "Colonia",
      "SURU": "Rivera",
      "SUME": "Mercedes"
    };

    // Referencia al contenedor de tarjetas
    const metarDiv = document.getElementById("metar");

    /**
     * Función para obtener el METAR de una estación
     * @param {string} station - código ICAO de la estación
     * @param {boolean} highlight - si es la estación principal a resaltar
     */
    async function fetchMETAR(station, highlight = false) {
      try {
        // Usamos proxy para evitar problemas de CORS
        const proxyUrl = 'https://api.allorigins.win/raw?url=';
        const metarUrl = `https://tgftp.nws.noaa.gov/data/observations/metar/stations/${station}.TXT`;

        // Descarga del METAR crudo
        const res = await fetch(proxyUrl + encodeURIComponent(metarUrl));
        const data = await res.text();

        // El archivo tiene dos líneas: fecha/hora y METAR
        const lines = data.trim().split("\n");
        const metar = lines[1]; // línea 2 = METAR original

        // Crear tarjeta que muestra solo el METAR crudo
        const card = document.createElement("div");
        card.className = "metar-card" + (highlight ? " highlight" : "");
        card.innerHTML = `
          <h3>${stations[station]} (${station})</h3>
          <pre class="metar-raw">${metar}</pre>
        `;

        // Agregar tarjeta al inicio si es destacada, si no al final
        if (highlight) {
          metarDiv.prepend(card);
        } else {
          metarDiv.appendChild(card);
        }
      } catch (error) {
        console.error("Error obteniendo METAR para", station);
      }
    }

    /**
     * Función para cargar todos los METAR
     */
    function loadAllMETARs() {
      metarDiv.innerHTML = ""; // limpiar antes de recargar
      for (const station in stations) {
        // Resaltar Carrasco (SUMU) como principal
        fetchMETAR(station, station === "SUMU");
      }
    }

    // Cargar al inicio
    loadAllMETARs();

    // Recargar cada hora
    setInterval(loadAllMETARs, 60 * 60 * 1000);
  </script>
</body>
</html>
